{% extends "default/layout/layout.html" %}
{% load static %}

{% block title %} Material Handling, Industrial Supplies, Tools, Safety Equipment & More {% endblock %}
{% block canonical_url %}{{request.scheme}}://{{request.META.HTTP_HOST}}{{request.path}}{% endblock %}

{% block ld_json %}
{{home_schema|safe}}
{% endblock %}

{% block content %}

		<!-- BREADCRUMB -->
		<div id="breadcrumb" class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-md-12">
						<ul class="breadcrumb-tree">
							<li><a href="/">Home</a></li>
							<li><a href="#">Add New Product</a></li>
						</ul>
					</div>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /BREADCRUMB -->

		<!-- SECTION -->
		<div class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<!-- Product main img -->
					<h1>Add New Product</h1>
					<form method="post" enctype="multipart/form-data">
						{% csrf_token %}
						{{ form.as_p }}

						<h3>Upload Product Images</h3>
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>Image</th>
									<th>Title</th>
									<th>Default</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody id="image-formset">
								{{ product_image_formset.management_form }}
						
								{% for form in product_image_formset %}
									<tr class="form-row">
										<td>{{ form.full_url }}</td>
										<td>{{ form.title }}</td>
										<td class="text-center">{{ form.is_default }}</td>
										<td><button type="button" class="btn btn-danger remove-image-form">Remove</button></td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
						
					
						<button type="button" class="btn btn-secondary" id="add-image-form">Add More Images</button>
						<button type="submit" class="btn btn-primary">Save Product</button>
					</form>
					
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /SECTION -->
{% endblock content %}
{% block extrajs %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const brandDropdown = document.getElementById('id_brand');
        const customBrandField = document.getElementById('id_other_brand');
        // Check if "Other" was selected and show the custom brand field
        brandDropdown.addEventListener('change', function() {
            if (brandDropdown.value === '3') {
                customBrandField.style.display = 'block';
            } else {
                customBrandField.style.display = 'none';
            }
        });
        // Initial check in case "Other" is already selected
        if (brandDropdown.value === '3') {
            customBrandField.style.display = 'block';
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formsetDiv = document.getElementById('image-formset');
        const addButton = document.getElementById('add-image-form');
        const totalForms = document.querySelector('[name$="-TOTAL_FORMS"]'); // Get the hidden management form count

        addButton.addEventListener('click', function () {
            let currentFormCount = parseInt(totalForms.value);  // Get the current count
            let emptyForm = formsetDiv.querySelector('.form-row'); // Get existing form

            if (!emptyForm) {
                alert("No existing form found!");
                return;
            }

            let newForm = emptyForm.cloneNode(true); // Clone existing form
            newForm.innerHTML = newForm.innerHTML.replace(/-\d+-/g, `-${currentFormCount}-`); 
            newForm.innerHTML = newForm.innerHTML.replace(/_\d+_/g, `_${currentFormCount}_`);

            formsetDiv.appendChild(newForm); // Add to the DOM
            totalForms.value = currentFormCount + 1; // Update total form count

            // Attach remove event to the new remove button
            newForm.querySelector('.remove-image-form').addEventListener('click', function () {
                newForm.remove();
                totalForms.value = parseInt(totalForms.value) - 1;
            });
        });

        // Attach remove event to existing remove buttons
        document.querySelectorAll('.remove-image-form').forEach(button => {
            button.addEventListener('click', function () {
                this.parentElement.remove();
                totalForms.value = parseInt(totalForms.value) - 1;
            });
        });
    });
</script>
{% endblock extrajs %}
